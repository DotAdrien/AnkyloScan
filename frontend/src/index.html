<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AnkyloScan</title>
    <link rel="stylesheet" href="style.css">
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="js/me.js"></script>
    <script src="js/login.js"></script>
</head>
<body x-data="{ 
    currentPage: 'landing', 
    user: { loggedIn: false }, 
    loading: false,
    pageContent: '',

    async init() { 
        // 1. On vÃ©rifie si l'utilisateur a un cookie valide au dÃ©marrage ğŸª
        await fetchMe.call(this); 
        
        // 2. On charge la page d'accueil par dÃ©faut
        await this.changePage('landing'); 
    },

    async changePage(pageName) {
        this.loading = true;
        try {
            const response = await fetch(`view/${pageName}.html`);
            if (!response.ok) throw new Error('Page introuvable');
            this.pageContent = await response.text();
            this.currentPage = pageName;
        } catch (err) {
            this.pageContent = '<h1>Erreur 404</h1><p>La page est introuvable ğŸ˜±</p>';
        } finally {
            this.loading = false;
        }
    }
}">

    <nav>
        <div class="nav-container">
            <span @click="changePage('landing')" style="cursor:pointer">ğŸ¦– AnkyloScan</span>
            <div>
                <template x-if="!user.loggedIn">
                    <button @click="changePage('login')">Connexion</button>
                </template>
                <template x-if="user.loggedIn">
                    <button @click="changePage('profile')">Mon Profil (ID: <span x-text="user.id"></span>)</button>
                </template>
            </div>
        </div>
    </nav>

    <main>
        <template x-if="loading">
            <div class="loader">Chargement... â³</div>
        </template>

        <div x-show="!loading" x-html="pageContent">
            </div>
    </main>

    <footer>
        <p>AnkyloScan - SÃ©curisÃ© par Tigrounet ğŸ±ğŸ˜¶</p>
    </footer>

</body>
</html>